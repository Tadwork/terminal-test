

<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/jquery.terminal.css">
		
        <script src="js/jquery-1.7.1.min.js"></script>
        <script src="js/jquery.terminal-0.8.8.js"></script>
		<script src="js/angular.js"></script>
		<style>
		.output-success{
		word-wrap: break-word;
		white-space: pre;
		color:green;
		}
		.output-error{
		word-wrap: break-word;
		white-space: pre;
		color:red;
		}
		.terminal{
		overflow:auto;
		}
		</style>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
		<script>
		angular.module("MyApp", [])
			.controller('MyCtrl', ['$scope','$rootScope', function ($scope,$rootScope) {
			$scope.stuff = [1, 2, 3];
			//$scope.out = [{cmd:"cmd"}];
			/*$scope.disable = function(){
				$rootScope.$broadcast('disable', true);
			};*/
		}])
			.directive('jqueryTerminal', function ($compile,$q) {
			
			return {
				restrict: 'E',
				replace: true,
				template: '<div class="terminal" ><div class="terminal-output" ng-repeat="cmd in out"><span>{{prompt}}</span><code>{{cmd.cmd}}</code><div class="command-output">'
				+ '<div ng-switch on="cmd.type">'
				+	  '<div ng-switch-when="loading"><output-loading/></div>'
				+	  '<div ng-switch-when="error"><output-error />{{cmd.output}}</div>'
				+	  '<div ng-switch-when="success"><output-success />{{cmd.output}}</div>'
				+	  '<div ng-switch-default>{{cmd.output}}</div>'
				+  '</div>'
				+ '</div></div><div class="cmd"></div></div>',
				link: function (scope, elem, attrs) {
				scope.out = [];
				function echo(type,cmd,output){
					scope.$apply(function(){
					var command = {
						type:"loading",
						cmd:cmd,
						output:null
					}
					if(angular.isFunction(cmd)){
						command.cmd = cmd();
					}else{
						$q.when(cmd).then(function(val){
							if(val.cmd) command.cmd = val.cmd;
							else command.cmd = val;
						})
					}
					if(angular.isFunction(type)){
						command.type = type();
					}else{
						$q.when(type).then(function(val){
							if(val.type) command.type = val.type;
							else command.type = val;
						})
					}
					if(angular.isFunction(output)){
						command.output = output();
					}else{
						$q.when(output).then(function(val){
							if(val.output) command.output = val.output;
							else command.output = val;
						})
					}
					
						scope.out.push(command)
					});
					elem[0].scrollTop = elem[0].scrollHeight;
				}
				$(elem).css({ "max-height":  $(elem).parent().height()+ 'px' });
				$(window).resize(function(){
				$(elem).css({ "max-height":  $(elem).parent().height()+ 'px' });
				});  
				scope.prompt = '$ ';
					$(elem).find('.cmd').cmd({
					commands:function (cmd) {
					echo(cmd,cmd,cmd)
					//if(cmd.length){
					//	return "$ [[;;;code]"+ cmd +"]";
					//}
					//term.echo(cmd);
					},
					prompt: scope.prompt,
					keydown: function(event,term){
						if(event.keyCode == 13 && event.shiftKey){
					//		term.exec("[[;;;code]"+ term.get_command() +"]")
							
						}
						
					},
					onCommandChange: function(cmd){
						$(".cmd > div").each(function(i,elem){
							$(elem).css("color","blue");
							});
						elem[0].scrollTop = elem[0].scrollHeight;	
					}
					});
					$(".prompt").next().css("color","red");
					/*$('.cursor').after($compile('<input type="text" name="userName" ng-model="user.name" ng-focus="disable=true" ng-blur="disable=false">')(scope));
					attrs.$observe('disabled', function(value) {
						$(elem).terminal().disable();
						//debugger;
					})*/
//scope.$apply(); 
				}
			};
		}).directive('outputLoading', function () {
			
			return {
				restrict: 'E',
				replace: true,
				template: '<span>loading ...</span>',
				link: function (scope, elem, attrs) {}}
			}).directive('outputError', function () {
			
			return {
				restrict: 'E',
				replace: true,
				transclude:true,
				template: '<span class="output-error"><ng-transclude/></span>',
				link: function (scope, elem, attrs) {}}
			}).directive('outputSuccess', function () {
			
			return {
				restrict: 'E',
				replace: true,
				transclude:true,
				template: '<span class="output-success"><ng-transclude/></span>',
				link: function (scope, elem, attrs) {}}
			});
		</script>
		<div ng-app="MyApp">
			<div ng-controller="MyCtrl" >
				<div style="background-color: red;height:100px">
				</div>
				<div style="background-color: black;height:400px">
				<jquery-terminal>
				</jquery-terminal>
				</div>
			</div>
		</div>
     
    </body>
</html>